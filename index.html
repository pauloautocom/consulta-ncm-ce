<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta NCM ‚Ä¢ CClassTrib ‚Ä¢ CST</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; padding:12px; }
h1 { text-align:center; }
input {
 width:100%; padding:14px; font-size:16px; margin-bottom:12px;
}
table { width:100%; border-collapse:collapse; background:#fff; }
th,td { border:1px solid #ccc; padding:10px; font-size:14px; }
th { background:#2563eb; color:#fff; }
tr:nth-child(even){ background:#eef2f7; }
.msg { text-align:center; margin-top:10px; color:#444; }
@media(max-width:600px){
 th,td{ font-size:12px; padding:8px; }
}
</style>
</head>
<body>

<h1>Consulta NCM ‚Ä¢ CClassTrib ‚Ä¢ CST</h1>

<input id="busca"
 placeholder="Digite produto ou NCM (ex: cacha√ßa, 22072020)"
 oninput="buscar()" />

<table>
<thead>
<tr>
 <th>NCM</th>
 <th>Descri√ß√£o</th>
 <th>CClassTrib</th>
 <th>CST</th>
</tr>
</thead>
<tbody id="resultado"></tbody>
</table>

<div id="msg" class="msg"></div>

<script>
// Normaliza√ß√£o
function norm(t){
 return t.toLowerCase()
  .normalize("NFD")
  .replace(/[\u0300-\u036f]/g,"")
  .trim();
}

// üîπ Base m√≠nima (NUNCA REMOVER)
const baseMinima = [
 { ncm:"22011000", desc:"√Åguas minerais e √°guas gaseificadas" },
 { ncm:"22011100", desc:"√Ågua mineral natural" },
 { ncm:"22021000", desc:"Refrigerantes" },
 { ncm:"22030000", desc:"Cervejas de malte" },
 { ncm:"22072020", desc:"Cacha√ßa" }
];

let baseCompleta = [...baseMinima];

// üîπ Carrega JSON oficial
fetch("ncm.json")
 .then(r => r.json())
 .then(dados => {
   dados.forEach(i=>{
     if(i.ncm && i.descricao){
       baseCompleta.push({
         ncm: String(i.ncm),
         desc: i.descricao
       });
     }
   });
   console.log("Base NCM carregada:", baseCompleta.length);
 })
 .catch(()=>{
   console.warn("JSON n√£o carregou, usando base m√≠nima");
 });

// Regra fiscal (exemplo)
function regraFiscal(ncm){
 return { cclasstrib:"000001", cst:"000" };
}

function buscar(){
 const v = norm(document.getElementById("busca").value);
 const tbody = document.getElementById("resultado");
 const msg = document.getElementById("msg");

 tbody.innerHTML = "";
 msg.innerText = "";

 if(v.length < 2) return;

 const nums = v.replace(/\D/g,"");

 const achou = baseCompleta.filter(i=>{
  return (
   (nums && i.ncm.startsWith(nums)) ||
   norm(i.desc).includes(v)
  );
 });

 if(achou.length === 0){
  msg.innerText = "Nenhum resultado encontrado";
  return;
 }

 achou.slice(0,50).forEach(i=>{
  const f = regraFiscal(i.ncm);
  tbody.innerHTML += `
<tr>
 <td>${i.ncm}</td>
 <td>${i.desc}</td>
 <td>${f.cclasstrib}</td>
 <td>${f.cst}</td>
</tr>`;
 });
}
</script>

</body>
</html>
