<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta NCM + Classificação Tributária (CE)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f3f4f6; padding:15px; }
.card {
  max-width:820px; margin:auto; background:#fff;
  padding:20px; border-radius:10px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
}
h1 { font-size:20px; }
input {
  width:100%; padding:12px; font-size:16px; margin-top:10px;
}
.resultado { margin-top:15px; }
.item {
  padding:12px; border-bottom:1px solid #ddd;
}
.badge {
  display:inline-block; padding:4px 8px;
  background:#2563eb; color:#fff;
  border-radius:6px; font-size:12px;
  margin-right:6px;
}
.cinza { background:#6b7280; }
.small { font-size:12px; color:#555; margin-top:4px; }
</style>
</head>

<body>

<div class="card">
<h1>Consulta Fiscal – Ceará</h1>
<p class="small">Busca por nome ou NCM • Base oficial NCM + regras CE</p>

<input id="busca" placeholder="Ex: arroz, cerveja, caneta, 22011000">

<div id="resultado" class="resultado"></div>
</div>

<script>
// ==========================
// BASE FÁCIL (nome comercial)
// ==========================
const baseFacil = [
  { ncm:"22011000", termos:["agua","agua mineral","água mineral"], nome:"Água mineral" },
  { ncm:"22021000", termos:["refrigerante","coca cola","guarana"], nome:"Refrigerante" },
  { ncm:"22030000", termos:["cerveja"], nome:"Cerveja" },
  { ncm:"10063021", termos:["arroz"], nome:"Arroz" },
  { ncm:"07133329", termos:["feijao","feijão"], nome:"Feijão" },
  { ncm:"19021900", termos:["macarrao","macarrão"], nome:"Macarrão" },
  { ncm:"09012100", termos:["cafe","café"], nome:"Café" },
  { ncm:"96081000", termos:["caneta"], nome:"Caneta esferográfica" },
  { ncm:"85444200", termos:["cabo usb","usb"], nome:"Cabo USB" },
  { ncm:"61091000", termos:["camisa","camiseta"], nome:"Camiseta de algodão" }
];

// ==========================
// REGRAS CCLASSTRIB – CE
// (classificação por FAIXA)
// ==========================
const regrasCE = [
  { ini:"01", fim:"21", cclass:"000030", cst:"010", desc:"Cesta básica / alimentos" },
  { ini:"22", fim:"22", cclass:"000020", cst:"000", desc:"Bebidas – Substituição Tributária" },
  { ini:"30", fim:"30", cclass:"000040", cst:"000", desc:"Medicamentos" },
  { ini:"61", fim:"63", cclass:"000050", cst:"010", desc:"Vestuário" },
  { ini:"84", fim:"85", cclass:"000060", cst:"000", desc:"Eletrônicos / elétricos" },
  { ini:"90", fim:"97", cclass:"000070", cst:"000", desc:"Diversos / papelaria / utilidades" }
];

let tabelaNCM = [];

// ==========================
// CARREGA TABELA OFICIAL
// ==========================
fetch("tabelancm.json")
  .then(r => r.json())
  .then(d => tabelaNCM = d)
  .catch(() => console.warn("Erro ao carregar tabelancm.json"));

// ==========================
function norm(t){
  return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

// ==========================
document.getElementById("busca").addEventListener("input", e => {
  const q = norm(e.target.value.trim());
  const res = document.getElementById("resultado");
  res.innerHTML = "";
  if(q.length < 2) return;

  let achados = [];

  // BASE FÁCIL
  baseFacil.forEach(p => {
    if(p.ncm.startsWith(q) || p.termos.some(t => norm(t).includes(q))){
      achados.push({ nome:p.nome, ncm:p.ncm });
    }
  });

  // BASE OFICIAL
  tabelaNCM.forEach(p => {
    const ncm = String(p.ncm || p.codigo || "").replace(/\D/g,"");
    const desc = norm(p.descricao || "");
    if(ncm.startsWith(q) || desc.includes(q)){
      achados.push({ nome:p.descricao, ncm });
    }
  });

  if(achados.length === 0){
    res.innerHTML = "<p class='small'>Nenhum resultado encontrado.</p>";
    return;
  }

  achados.slice(0,25).forEach(p => {
    const cap = p.ncm.substring(0,2);
    const regra = regrasCE.find(r => cap >= r.ini && cap <= r.fim);

    res.innerHTML += `
      <div class="item">
        <b>${p.nome}</b><br>
        NCM: ${p.ncm}<br>
        <span class="badge">CClassTrib: ${regra ? regra.cclass : "Não definido"}</span>
        <span class="badge ${regra ? "" : "cinza"}">CST: ${regra ? regra.cst : "—"}</span>
        <div class="small">${regra ? regra.desc : "Sem regra específica CE"}</div>
      </div>
    `;
  });
});
</script>

</body>
</html>
