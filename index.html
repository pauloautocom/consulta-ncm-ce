<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta NCM • CClassTrib CE</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
  padding: 15px;
}
.card {
  max-width: 900px;
  background: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
}
h1 {
  font-size: 22px;
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  font-size: 16px;
}
.resultado {
  background: #eef6ff;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
}
.erro {
  background: #fee2e2;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
}
.small {
  font-size: 12px;
  color: #555;
}
</style>
</head>

<body>
<div class="card">
  <h1>Consulta NCM e CClassTrib – Ceará</h1>
  <input id="busca" placeholder="Ex: arroz, caneta, água mineral, 22011000">
  <div id="saida"></div>
</div>

<script>
// =====================
// BASE COMERCIAL AMPLIADA
// =====================
const base = [
  { termos:["arroz"], ncm:"10063021", desc:"Arroz beneficiado", tipo:"cesta" },
  { termos:["feijao","feijão"], ncm:"07133329", desc:"Feijão comum", tipo:"cesta" },
  { termos:["oleo","óleo"], ncm:"15079011", desc:"Óleo vegetal", tipo:"cesta" },
  { termos:["acucar","açúcar"], ncm:"17019900", desc:"Açúcar", tipo:"cesta" },

  { termos:["agua","agua mineral"], ncm:"22011000", desc:"Água mineral", tipo:"bebida" },
  { termos:["refrigerante","coca","coca cola"], ncm:"22021000", desc:"Refrigerante", tipo:"bebida" },
  { termos:["cerveja"], ncm:"22030000", desc:"Cerveja", tipo:"bebida" },

  { termos:["caneta"], ncm:"96081000", desc:"Caneta esferográfica", tipo:"comum" },
  { termos:["lapis","lápis"], ncm:"96091000", desc:"Lápis", tipo:"comum" },

  { termos:["camisa"], ncm:"61051000", desc:"Camisa de algodão", tipo:"comum" },
  { termos:["cabo usb","usb"], ncm:"85444200", desc:"Cabo USB", tipo:"comum" }
];

// =====================
// CLASSIFICAÇÃO OFICIAL
// =====================
function classificar(produto) {
  // REGRA BASEADA NA TABELA OFICIAL
  if (produto.tipo === "bebida") {
    return { cclass:"000001", cst:"010", motivo:"Bebidas – tributação integral" };
  }

  // Cesta básica e produtos comuns
  return { cclass:"000001", cst:"000", motivo:"Tributação integral" };
}

// =====================
function normalizar(txt){
  return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

document.getElementById("busca").addEventListener("input", function(){
  const q = normalizar(this.value.trim());
  const out = document.getElementById("saida");
  out.innerHTML = "";
  if (q.length < 2) return;

  let p = base.find(b =>
    b.termos.some(t => normalizar(t).includes(q)) ||
    b.ncm.startsWith(q)
  );

  if (!p) {
    out.innerHTML = `<div class="erro"><b>Nenhum resultado encontrado</b></div>`;
    return;
  }

  const trib = classificar(p);

  out.innerHTML = `
    <div class="resultado">
      <b>Produto:</b> ${p.desc}<br>
      <b>NCM:</b> ${p.ncm}<br><br>
      <b>CClassTrib (CE):</b> ${trib.cclass}<br>
      <b>CST para CClassTrib:</b> ${trib.cst}<br>
      <span class="small">${trib.motivo}</span>
    </div>
  `;
});
</script>
</body>
</html>
