<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta NCM e cClassTrib - CE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:15px;
}
h1 {
  text-align:center;
  font-size:22px;
}
input {
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:6px;
  border:1px solid #ccc;
  margin-bottom:15px;
}
.card {
  background:#fff;
  padding:12px;
  border-radius:6px;
  margin-bottom:10px;
  box-shadow:0 1px 4px rgba(0,0,0,.1);
}
.label {
  font-weight:bold;
}
</style>
</head>

<body>

<h1>Consulta NCM / cClassTrib ‚Äì Cear√°</h1>

<input
  id="busca"
  type="text"
  placeholder="Digite nome ou NCM (ex: √°gua, cerveja, 2201)"
  oninput="buscar()"
/>

<div id="resultados"></div>

<script>
let ncmData = [];
let cClassData = [];

// üîπ Fun√ß√£o para normalizar texto (remove acento)
function normalizar(txt) {
  return txt.toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");
}

// üîπ Carrega NCM
fetch('ncm.json')
  .then(r => r.json())
  .then(d => ncmData = d);

// üîπ Carrega cClassTrib
fetch('cclasstrib.json')
  .then(r => r.json())
  .then(d => cClassData = d);

function buscar() {
  const termoOriginal = document.getElementById('busca').value.trim();
  const termo = normalizar(termoOriginal);
  const res = document.getElementById('resultados');
  res.innerHTML = '';

  if (termo.length < 2) return;

  const encontrados = ncmData.filter(item => {
    const ncm = item.ncm.replace(/\D/g, '');
    const desc = normalizar(item.descricao || '');
    return ncm.includes(termo) || desc.includes(termo);
  });

  if (encontrados.length === 0) {
    res.innerHTML = '<p>Nenhum resultado encontrado.</p>';
    return;
  }

  encontrados.slice(0, 20).forEach(item => {
    // üîπ REGRA PADR√ÉO MERCANTIL ‚Äì CE
    const cst = "000"; // Tributa√ß√£o integral
    const cclass = cClassData.find(c =>
      c.cclasstrib === "000001"
    );

    res.innerHTML += `
      <div class="card">
        <div><span class="label">Produto:</span> ${item.descricao}</div>
        <div><span class="label">NCM:</span> ${item.ncm}</div>
        <div><span class="label">CST p/ cClassTrib:</span> ${cst}</div>
        <div><span class="label">cClassTrib:</span> ${cclass?.cclasstrib || '000001'}</div>
        <div><span class="label">Descri√ß√£o cClassTrib:</span> ${cclass?.descricao || 'Tributa√ß√£o integral'}</div>
      </div>
    `;
  });
}
</script>

</body>
</html>
