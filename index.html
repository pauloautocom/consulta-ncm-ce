<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta NCM e CClassTrib – CE</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 15px;
}

h1 {
  text-align: center;
  font-size: 22px;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 10px;
}

.card {
  background: #fff;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,.1);
}

.ok { color: green; font-weight: bold; }
.warn { color: #666; font-size: 14px; }
.loading { color: #999; }
</style>
</head>

<body>

<h1>Consulta NCM e Classificação Tributária (CE)</h1>

<input
  id="busca"
  placeholder="Digite nome do produto ou NCM (ex: arroz, congelados, 03075200)"
  oninput="buscar()"
/>

<div id="resultado" class="loading">Carregando tabela oficial…</div>

<script>
// =====================
// BASE CE (VALIDADA)
// =====================
const baseCE = [
  { nome:"Água mineral", ncm:"22011000", cclasstrib:"000010", cst:"010" },
  { nome:"Refrigerante", ncm:"22021000", cclasstrib:"000010", cst:"010" },
  { nome:"Cerveja", ncm:"22030000", cclasstrib:"000010", cst:"010" },
  { nome:"Arroz", ncm:"10063021", cclasstrib:"000001", cst:"000" },
  { nome:"Feijão", ncm:"07133399", cclasstrib:"000001", cst:"000" },
  { nome:"Macarrão", ncm:"19021900", cclasstrib:"000001", cst:"000" },
  { nome:"Biscoito", ncm:"19053100", cclasstrib:"000001", cst:"000" },
  { nome:"Caneta esferográfica", ncm:"96081000", cclasstrib:"000003", cst:"000" }
];

// =====================
// TABELA NCM OFICIAL
// =====================
let tabelaNCM = [];
let carregado = false;

fetch("tabelancm.json")
  .then(r => r.json())
  .then(d => {
    tabelaNCM = d.map(n => ({
      ncm: n.ncm.replace(/\D/g, ""),
      descricao: n.descricao
    }));
    carregado = true;
    document.getElementById("resultado").innerHTML = "";
  });

// =====================
function normalizar(txt){
  return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

function buscar(){
  const termo = document.getElementById("busca").value.trim();
  const res = document.getElementById("resultado");
  res.innerHTML = "";

  if (!carregado){
    res.innerHTML = "Carregando tabela NCM…";
    return;
  }

  if (termo.length < 2) return;

  const termoN = normalizar(termo);
  const termoNum = termo.replace(/\D/g,"");

  // 1️⃣ BASE CE
  const ce = baseCE.filter(p =>
    normalizar(p.nome).includes(termoN) ||
    p.ncm.includes(termoNum)
  );

  if (ce.length){
    ce.forEach(p=>{
      res.innerHTML += `
      <div class="card">
        <strong>${p.nome}</strong><br>
        NCM: ${p.ncm}<br>
        CClassTrib (CE): <span class="ok">${p.cclasstrib}</span><br>
        CST para CClassTrib: <span class="ok">${p.cst}</span>
      </div>`;
    });
    return;
  }

  // 2️⃣ TABELA OFICIAL
  const oficiais = tabelaNCM.filter(n =>
    (termoNum && n.ncm.includes(termoNum)) ||
    normalizar(n.descricao).includes(termoN)
  ).slice(0, 50);

  if (oficiais.length){
    oficiais.forEach(n=>{
      res.innerHTML += `
      <div class="card">
        <strong>${n.descricao}</strong><br>
        NCM: ${n.ncm}<br>
        <span class="warn">
          Classificação tributária depende do enquadramento no CE
        </span>
      </div>`;
    });
  } else {
    res.innerHTML = "Nenhum resultado encontrado.";
  }
}
</script>

</body>
</html>
