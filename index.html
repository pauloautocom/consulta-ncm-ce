<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta NCM • CClassTrib CE</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
  padding: 15px;
}
.card {
  max-width: 800px;
  background: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
}
h1 {
  font-size: 22px;
  margin-bottom: 5px;
}
.small {
  font-size: 13px;
  color: #555;
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}
.resultado {
  background: #eef6ff;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
}
.erro {
  background: #fee2e2;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
}
@media (max-width:600px) {
  h1 { font-size: 20px; }
}
</style>
</head>

<body>

<div class="card">
  <h1>Consulta NCM e CClassTrib</h1>
  <p class="small">Estado do Ceará • Busca por nome comercial ou NCM</p>

  <input id="busca" placeholder="Ex: água mineral, coca cola, cerveja, 22011000">

  <div id="saida"></div>
</div>

<script>
// ============================
// BASE COMERCIAL (PROCURA FÁCIL)
// ============================
const baseComercial = [
  { termos:["agua","agua mineral"], ncm:"22011000", desc:"Água mineral natural" },
  { termos:["refrigerante","coca","coca cola"], ncm:"22021000", desc:"Refrigerantes" },
  { termos:["cerveja"], ncm:"22030000", desc:"Cerveja de malte" },
  { termos:["arroz"], ncm:"10063021", desc:"Arroz beneficiado" },
  { termos:["feijao","feijão"], ncm:"07133329", desc:"Feijão comum" },
  { termos:["oleo","óleo soja"], ncm:"15079011", desc:"Óleo de soja" },
  { termos:["acucar","açucar","açúcar"], ncm:"17019900", desc:"Açúcar refinado" },
  { termos:["biscoito","bolacha"], ncm:"19053100", desc:"Biscoitos" },
  { termos:["vinagre"], ncm:"22090000", desc:"Vinagre" },
  { termos:["ovo","ovos"], ncm:"04072100", desc:"Ovos de galinha" },
  { termos:["banana"], ncm:"08039000", desc:"Banana" },
  { termos:["batata"], ncm:"07019000", desc:"Batata" },
  { termos:["carne bovina"], ncm:"02013000", desc:"Carne bovina" },
  { termos:["caneta"], ncm:"96081000", desc:"Caneta esferográfica" },
  { termos:["lapis","lápis"], ncm:"96091000", desc:"Lápis" },
  { termos:["camisa","camisa algodao"], ncm:"61051000", desc:"Camisa de algodão" },
  { termos:["cabo usb","usb"], ncm:"85444200", desc:"Cabo USB" },
  { termos:["mouse"], ncm:"84716053", desc:"Mouse" },
  { termos:["teclado"], ncm:"84716052", desc:"Teclado" }
];

// ============================
// CCLASSTRIB CE + CST
// ============================
function classificarCE(ncm) {
  if (ncm.startsWith("22")) {
    return { cclass:"000010", cst:"010", motivo:"Bebidas" };
  }
  if (["1006","0713","1507","1701","1905","0407"].some(p=>ncm.startsWith(p))) {
    return { cclass:"000001", cst:"000", motivo:"Cesta básica" };
  }
  if (ncm.startsWith("61") || ncm.startsWith("62")) {
    return { cclass:"000020", cst:"010", motivo:"Vestuário" };
  }
  return { cclass:"000000", cst:"000", motivo:"Tributação padrão" };
}

// ============================
// NORMALIZA TEXTO
// ============================
function norm(txt){
  return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

// ============================
// BUSCA
// ============================
document.getElementById("busca").addEventListener("input", buscar);

function buscar() {
  const q = norm(this.value.trim());
  const out = document.getElementById("saida");
  out.innerHTML = "";
  if (q.length < 2) return;

  let achou = null;

  // Nome
  achou = baseComercial.find(p =>
    p.termos.some(t => norm(t).includes(q) || q.includes(norm(t)))
  );

  // NCM
  if (!achou && /^\d{3,8}$/.test(q)) {
    achou = baseComercial.find(p => p.ncm.startsWith(q));
  }

  if (!achou) {
    out.innerHTML = `<div class="erro"><b>Nenhum resultado encontrado</b></div>`;
    return;
  }

  const trib = classificarCE(achou.ncm);

  out.innerHTML = `
    <div class="resultado">
      <b>Produto:</b> ${achou.desc}<br>
      <b>NCM:</b> ${achou.ncm}<br><br>
      <b>CClassTrib (CE):</b> ${trib.cclass}<br>
      <b>CST para CClassTrib:</b> ${trib.cst}<br>
      <span class="small">${trib.motivo}</span>
    </div>
  `;
}
</script>

</body>
</html>
