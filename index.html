<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta NCM â€¢ Mercantil â€¢ CE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f3f4f6; padding:10px; }
h1 { text-align:center; font-size:20px; }
input {
 width:100%; padding:14px; font-size:16px; margin-bottom:12px;
}
table { width:100%; border-collapse:collapse; background:#fff; }
th,td { border:1px solid #ccc; padding:8px; font-size:14px; }
th { background:#1e40af; color:#fff; }
tr:nth-child(even){ background:#eef2f7; }
.msg { text-align:center; margin-top:10px; color:#555; }
@media(max-width:600px){
 th,td{ font-size:12px; }
}
</style>
</head>
<body>

<h1>Consulta NCM â€¢ Mercantil â€¢ CearÃ¡</h1>

<input id="busca"
 placeholder="Digite produto ou NCM (ex: arroz, cerveja, 2201)"
 oninput="buscar()" />

<table>
<thead>
<tr>
 <th>NCM</th>
 <th>DescriÃ§Ã£o</th>
 <th>CClassTrib (CE)</th>
 <th>CST</th>
</tr>
</thead>
<tbody id="resultado"></tbody>
</table>

<div id="msg" class="msg"></div>

<script>
function norm(t){
 return t.toLowerCase()
  .normalize("NFD")
  .replace(/[\u0300-\u036f]/g,"")
  .trim();
}

// ðŸ”¹ BASE MERCANTIL
const baseLocal = [
 {ncm:"10063021", desc:"Arroz"},
 {ncm:"07133319", desc:"FeijÃ£o"},
 {ncm:"17019900", desc:"AÃ§Ãºcar"},
 {ncm:"09012100", desc:"CafÃ©"},
 {ncm:"04012010", desc:"Leite"},
 {ncm:"11010010", desc:"Farinha de trigo"},
 {ncm:"19021900", desc:"MacarrÃ£o"},
 {ncm:"15079011", desc:"Ã“leo de soja"},
 {ncm:"22011000", desc:"Ãgua mineral"},
 {ncm:"22021000", desc:"Refrigerante"},
 {ncm:"22030000", desc:"Cerveja"},
 {ncm:"22072020", desc:"CachaÃ§a"},
 {ncm:"19053100", desc:"Biscoito"},
 {ncm:"16010000", desc:"LinguiÃ§a"},
 {ncm:"02013000", desc:"Carne bovina"},
 {ncm:"02071200", desc:"Frango"}
];

let baseCompleta = [...baseLocal];

// ðŸ”¹ JSON completo
fetch("ncm.json")
 .then(r=>r.json())
 .then(d=>{
  d.forEach(i=>{
   if(i.ncm && i.descricao){
    baseCompleta.push({ ncm:String(i.ncm), desc:i.descricao });
   }
  });
 });

// ðŸ”¹ Regra CE simplificada
function regraCE(ncm){
 if(ncm.startsWith("22")) return {c:"000002", cst:"060"}; // bebidas ST
 return {c:"000001", cst:"000"}; // tributado
}

function buscar(){
 const v = norm(document.getElementById("busca").value);
 const tbody = document.getElementById("resultado");
 const msg = document.getElementById("msg");

 tbody.innerHTML="";
 msg.innerText="";

 if(v.length<2) return;

 const num = v.replace(/\D/g,"");

 const res = baseCompleta.filter(i=>{
  return (
   (num && i.ncm.startsWith(num)) ||
   norm(i.desc).includes(v)
  );
 });

 if(res.length===0){
  msg.innerText="Nenhum resultado encontrado";
  return;
 }

 res.slice(0,50).forEach(i=>{
  const r = regraCE(i.ncm);
  tbody.innerHTML+=`
<tr>
 <td>${i.ncm}</td>
 <td>${i.desc}</td>
 <td>${r.c}</td>
 <td>${r.cst}</td>
</tr>`;
 });
}
</script>

</body>
</html>
