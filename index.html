<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta NCM + CClassTrib CE</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 15px;
}

h1 {
  text-align: center;
  font-size: 22px;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 10px;
}

.card {
  background: #fff;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,.1);
}

.card strong {
  font-size: 16px;
}

.muted {
  color: #666;
  font-size: 14px;
}
</style>
</head>

<body>

<h1>Consulta NCM e Classificação Tributária (CE)</h1>

<input
  id="busca"
  type="text"
  placeholder="Digite nome do produto ou NCM (ex: arroz, cerveja, 22011000)"
  oninput="buscar()"
/>

<div id="resultado"></div>

<script>
// ============================
// BASE FÁCIL (NOME COMERCIAL)
// ============================
const baseFacil = [
  { nome: "Água mineral", ncm: "22011000", cclasstrib: "000010", cst: "010" },
  { nome: "Refrigerante", ncm: "22021000", cclasstrib: "000010", cst: "010" },
  { nome: "Cerveja", ncm: "22030000", cclasstrib: "000010", cst: "010" },
  { nome: "Arroz", ncm: "10063021", cclasstrib: "000001", cst: "000" },
  { nome: "Feijão", ncm: "07133399", cclasstrib: "000001", cst: "000" },
  { nome: "Macarrão", ncm: "19021900", cclasstrib: "000001", cst: "000" },
  { nome: "Biscoito", ncm: "19053100", cclasstrib: "000001", cst: "000" },
  { nome: "Café", ncm: "09012100", cclasstrib: "000001", cst: "000" },
  { nome: "Caneta esferográfica", ncm: "96081000", cclasstrib: "000003", cst: "000" },
  { nome: "Lápis", ncm: "96091000", cclasstrib: "000003", cst: "000" },
  { nome: "Cabo USB", ncm: "85444200", cclasstrib: "000003", cst: "000" },
  { nome: "Camisa de algodão", ncm: "61051000", cclasstrib: "000003", cst: "000" }
];

// ============================
// TABELA NCM OFICIAL
// ============================
let tabelaNCM = [];

fetch("tabelancm.json")
  .then(r => r.json())
  .then(dados => tabelaNCM = dados);

// ============================
// FUNÇÕES
// ============================
function normalizar(txt) {
  return txt
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");
}

function buscar() {
  const termoOriginal = document.getElementById("busca").value.trim();
  const termo = normalizar(termoOriginal);
  const resultado = document.getElementById("resultado");
  resultado.innerHTML = "";

  // Não pesquisar enquanto digita pouco
  if (termo.length < 3) return;

  // ============================
  // 1️⃣ BUSCA NA BASE FÁCIL
  // ============================
  const achadosFacil = baseFacil.filter(p =>
    normalizar(p.nome).includes(termo) ||
    p.ncm.startsWith(termoOriginal)
  );

  if (achadosFacil.length) {
    achadosFacil.forEach(p => {
      resultado.innerHTML += `
        <div class="card">
          <strong>${p.nome}</strong><br>
          NCM: ${p.ncm}<br>
          CClassTrib (CE): ${p.cclasstrib}<br>
          CST para CClassTrib: ${p.cst}
        </div>
      `;
    });
    return;
  }

  // ============================
  // 2️⃣ BUSCA NA TABELA OFICIAL
  // ============================
  const achadosNCM = tabelaNCM.filter(n =>
    n.ncm.startsWith(termoOriginal) ||
    normalizar(n.descricao).includes(termo)
  );

  if (achadosNCM.length) {
    achadosNCM.slice(0, 30).forEach(n => {
      resultado.innerHTML += `
        <div class="card">
          <strong>${n.descricao}</strong><br>
          NCM: ${n.ncm}<br>
          <span class="muted">
            Classificação tributária (CClassTrib / CST) depende do enquadramento no CE
          </span>
        </div>
      `;
    });
  } else {
    resultado.innerHTML = "Nenhum resultado encontrado.";
  }
}
</script>

</body>
</html>
